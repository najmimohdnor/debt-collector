<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Debt_Collector.ActivityLogPage">
    <ScrollView>
        <VerticalStackLayout Padding="10">
            <!-- Page Title -->
            <Label Text="Activity Logs" FontSize="24" FontAttributes="Bold" HorizontalOptions="Center" Margin="0,20" />
            <Image Source="logs_image.png" WidthRequest="50" HeightRequest="50"/>
            <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />

            <!-- Placeholder for no activity logs -->
            <Frame x:Name="PlaceholderFrame" BorderColor="LightGray" Padding="10" CornerRadius="10" HorizontalOptions="Fill" VerticalOptions="Center">
                <Label Text="Your activity log(s) will appear here. Currently no activity logs are available." HorizontalOptions="Center" VerticalOptions="Center" />
                <Frame.Triggers>
                    <DataTrigger TargetType="Frame" Binding="{Binding ActivityLogs.Count}" Value="0">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                    <DataTrigger TargetType="Frame" Binding="{Binding ActivityLogs.Count}" Value="1">
                        <Setter Property="IsVisible" Value="False" />
                    </DataTrigger>
                </Frame.Triggers>
            </Frame>
            <!-- Clear All Logs Button -->
            <Button Text="Clear All Logs" x:Name="ClearAllButton" Clicked="OnClearAll" IsVisible="False" Margin="0,5" BackgroundColor="DarkRed" CornerRadius="30" Padding="20"/>

            <!-- Activity Log List -->
            <CollectionView x:Name="ActivityLogList" ItemsSource="{Binding ActivityLogs}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BorderColor="LightGray" Padding="15" Margin="0,5" CornerRadius="10">
                            <VerticalStackLayout Spacing="10">
                                <!-- LogType and Remove Button -->
                                <Frame BorderColor="LightGray" Padding="20" CornerRadius="20" BackgroundColor="Black">
                                    <Grid>
                                        <!-- Define Two Columns -->
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <!-- Takes all remaining space -->
                                            <ColumnDefinition Width="Auto" />
                                            <!-- Auto-width for the trash icon -->
                                        </Grid.ColumnDefinitions>

                                        <!-- LogType Label -->
                                        <Label Text="{Binding LogType}" FontSize="16" VerticalTextAlignment="Center"
                                        VerticalOptions="Center" Grid.Column="0" TextColor="White" FontAttributes="Bold"/>
                                        
                                        <!-- Trash Icon ImageButton -->
                                        <ImageButton Source="trash_icon.png" Clicked="OnDeleteLog" CommandParameter="{Binding .}"
                                        WidthRequest="30" HeightRequest="30" BackgroundColor="Transparent"
                                        Grid.Column="1" HorizontalOptions="End" VerticalOptions="Center" />
                                    </Grid>
                                </Frame>

                                <!-- Person Name and Debt Type -->
                                <HorizontalStackLayout>
                                    <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="24" TextColor="SlateBlue"/>
                                    <Label Text="{Binding DebtType}" FontAttributes="Italic" Margin="10,0,0,0" />
                                </HorizontalStackLayout>

                                <!-- Phone Number -->
                                <Label Text="{Binding PhoneNumber, StringFormat='Phone: {0}'}" />

                                <!-- Separation Line -->
                                <BoxView HeightRequest="1" BackgroundColor="LightGray" Margin="0,10,0,10" />

                                <!-- Conditional Layouts for Different Log Types -->
                                <ContentView>
                                    <ContentView.Triggers>
                                        <DataTrigger TargetType="ContentView" Binding="{Binding LogType}" Value="Record Added">
                                            <Setter Property="Content">
                                                <VerticalStackLayout>
                                                    <Label Text="Total Debt (RM):" FontSize="Micro" FontAttributes="Bold" />
                                                    <Label Text="{Binding DebtAmount}" FontSize="Large" FontAttributes="Bold" />
                                                    <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />
                                                    <Label>
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding ActionDate, StringFormat='Created on: {0:dd/MM/yyyy}'}" />
                                                                <Span Text="    " />
                                                                <Span Text="{Binding ActionDate, StringFormat='{0:hh:mm tt}'}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </VerticalStackLayout>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="ContentView" Binding="{Binding LogType}" Value="Record Deleted">
                                            <Setter Property="Content">
                                                <VerticalStackLayout>
                                                    <Label Text="Total Debt (RM):" FontSize="Micro" FontAttributes="Bold" />
                                                    <Label Text="{Binding DebtAmount}" FontSize="Large" FontAttributes="Bold" />
                                                    <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />
                                                    <Label>
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding ActionDate, StringFormat='Deleted on: {0:dd/MM/yyyy}'}" />
                                                                <Span Text="    " />
                                                                <Span Text="{Binding ActionDate, StringFormat='{0:hh:mm tt}'}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </VerticalStackLayout>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="ContentView" Binding="{Binding LogType}" Value="Payment Made">
                                            <Setter Property="Content">
                                                <VerticalStackLayout>
                                                    <Frame BorderColor="LightGray" Padding="5" CornerRadius="10">
                                                        <VerticalStackLayout>
                                                            <Label Text="{Binding DebtStatus}" FontAttributes="Italic" FontSize="14" />
                                                            <Label Text="{Binding DebtProgress, StringFormat=' {0:P0}'}" HorizontalOptions="EndAndExpand" />
                                                        </VerticalStackLayout>
                                                    </Frame>
                                                    <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />
                                                    <Grid ColumnDefinitions="*,*">
                                                        <Label Text="Paid (RM):" FontSize="Micro" FontAttributes="Bold" />
                                                        <Label Text="Debt Balance (RM):" FontSize="Micro" FontAttributes="Bold" Grid.Column="1" />
                                                    </Grid>
                                                    <Grid ColumnDefinitions="*,*">
                                                        <Label Text="{Binding AmountPaid}" FontSize="Large" FontAttributes="Bold" Grid.Row="1" />
                                                        <Label Text="{Binding RemainingBalance}" FontSize="Large" FontAttributes="Bold" Grid.Column="1" Grid.Row="1" />
                                                    </Grid>
                                                    <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />
                                                    <Label>
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding ActionDate, StringFormat='Created on: {0:dd/MM/yyyy}'}" />
                                                                <Span Text="    " />
                                                                <Span Text="{Binding ActionDate, StringFormat='{0:hh:mm tt}'}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </VerticalStackLayout>
                                            </Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="ContentView" Binding="{Binding LogType}" Value="Amount Borrowed">
                                            <Setter Property="Content">
                                                <VerticalStackLayout>
                                                    <Frame BorderColor="LightGray" Padding="5" CornerRadius="10">
                                                        <VerticalStackLayout>
                                                            <Label Text="{Binding DebtStatus}" FontAttributes="Italic" FontSize="14" />
                                                            <Label Text="{Binding DebtProgress, StringFormat=' {0:P0}'}" HorizontalOptions="EndAndExpand" />
                                                        </VerticalStackLayout>
                                                    </Frame>
                                                    <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />
                                                    <Grid ColumnDefinitions="*,*,*">
                                                        <Label Text="Borrowed (RM):" FontSize="Micro" FontAttributes="Bold" />
                                                        <Label Text="Debt Balance (RM):" FontSize="Micro" FontAttributes="Bold" Grid.Column="1" />
                                                        <Label Text="Total Debt (RM):" FontSize="Micro" FontAttributes="Bold" Grid.Column="2" />
                                                    </Grid>
                                                    <Grid ColumnDefinitions="*,*,*">
                                                        <Label Text="{Binding AmountBorrowed}" FontSize="Large" FontAttributes="Bold" Grid.Row="1" />
                                                        <Label Text="{Binding RemainingBalance}" FontSize="Large" FontAttributes="Bold" Grid.Column="1" Grid.Row="1" />
                                                        <Label Text="{Binding DebtAmount}" FontSize="Large" FontAttributes="Bold" Grid.Column="2" Grid.Row="1" />
                                                    </Grid>
                                                    <BoxView HeightRequest="0" BackgroundColor="LightGray" Margin="0,10,0,10" />
                                                    <Label>
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding ActionDate, StringFormat='Created on: {0:dd/MM/yyyy}'}" />
                                                                <Span Text="    " />
                                                                <Span Text="{Binding ActionDate, StringFormat='{0:hh:mm tt}'}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </VerticalStackLayout>
                                            </Setter>
                                        </DataTrigger>
                                    </ContentView.Triggers>
                                </ContentView>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>